import time
import requests
import urllib.request
import pandas as pd
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.common.keys import Keys
from selenium.webdriver.chrome.service import Service
from selenium.webdriver.support.ui import WebDriverWait
from webdriver_manager.chrome import ChromeDriverManager as CM
from selenium.webdriver.support import expected_conditions as EC
from selenium.webdriver.common.action_chains import ActionChains


# Complete these 2 fields ==================
# USERNAME = input('Enter Your Username: ')
# PASSWORD = input('Enter Your Password: ')
# usr = input('[Required] - Whose followers do you want to scrape: ')
# user_input = int(input('[Required] - How many followers do you want to scrape (60-500 recommended): '))
USERNAME = 'ma.zhar264'
PASSWORD = 'Mazhar.123'
usr = "leomessi"
# ==========================================

TIMEOUT = 15

options = webdriver.ChromeOptions()
# options.add_argument("--headless")
options.add_argument('--no-sandbox')
options.add_argument("--log-level=3")
mobile_emulation = {
    "userAgent": "Mozilla/5.0 (Linux; Android 4.2.1; en-us; Nexus 5 Build/JOP40D) AppleWebKit/535.19 (KHTML, like Gecko) Chrome/90.0.1025.166 Mobile Safari/535.19"}
options.add_experimental_option("mobileEmulation", mobile_emulation)

driver = webdriver.Chrome(executable_path=CM().install(), options=options)
# driver.set_window_size(600, 1000)
driver.maximize_window()
driver.get('https://www.instagram.com/accounts/login/')


def log_in(user_name, pass_word):
    time.sleep(2)

    print("[Info] - Logging in...")

    user_element = WebDriverWait(driver, TIMEOUT).until(
        EC.presence_of_element_located((
            By.XPATH, '//*[@id="loginForm"]/div[1]/div[3]/div/label/input')))

    user_element.send_keys(user_name)

    pass_element = WebDriverWait(driver, TIMEOUT).until(
        EC.presence_of_element_located((
            By.XPATH, '//*[@id="loginForm"]/div[1]/div[4]/div/label/input')))

    pass_element.send_keys(pass_word)

    login_button = WebDriverWait(driver, TIMEOUT).until(
        EC.presence_of_element_located((
            By.XPATH, '//*[@id="loginForm"]/div[1]/div[6]/button')))
    time.sleep(0.4)
    login_button.click()

    time.sleep(5)

    driver.get('https://www.instagram.com/{}/'.format(usr))

    time.sleep(5)


def user_data():
    time.sleep(5)
    URL = driver.current_url
    accountUsername = driver.find_element(
        By.XPATH, "//a[@href = '#'][@role ='link']/h2").text
    accountName = driver.find_element(
        By.XPATH, "//span[@class='_aacl _aacp _aacw _aacx _aad7 _aade']").text
    accountFollowers = driver.find_element(
        By.XPATH, "//a[@role='link']/div[@class='_aacl _aacp _aacu _aacx _aad6 _aade']/span[@class ='_ac2a']").get_attribute('title')
    if accountFollowers > 1000:
        # save the data in Database
        return URL, accountUsername, accountName, accountFollowers
    else:
        return driver.back()


# main
log_in(USERNAME, PASSWORD)
user_data()
Followers_list = driver.find_element(
    By.XPATH, "//a[@role='link']//div[@class='_aacl _aacp _aacu _aacx _aad6 _aade'][contains(text(),' following')]")
Followers_list.click()
time.sleep(5)
Followers = driver.find_element(
    By.XPATH, "//a[@role='link']//span[contains(@class,'_aacl _aaco _aacw _aacx _aad7 _aade')]//div[contains(@class,'_ab94 _ab97 _ab9f _ab9k _ab9p _abcm')]")
Followers.click()
for i in 
user_data()
driver.back()
